
<!DOCTYPE HTML> 
<html lang="en"> 
<head>
<title>Looper 2: PEER2</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta http-equiv="Content-Language" content="en-us"> 

<link href="fancy.css" rel="stylesheet" type="text/css">
<style>
  #chatbox {
    background-color: #FFF;
    width: 250px;
    text-align: center;
    padding: 10px;
    float: right;
    height: 800px;
  }
  ul#chat{
    text-align: left;
  }
</style>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="https://rawgit.com/nexus-js/ui/master/dist/NexusUI.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/0.12.66/Tone.js"></script>
<script type="text/javascript" src="./peer.js"></script>
<script type="text/javascript" src="./node.js"></script>
</head>
<body>
  <h1 id='node-id'>Node Id: </h1>
  <h2 id='station-id'>Station Id: </h2>
  <div id='chatbox'>
    <ul id="chat"></ul>
    <form id="send">
      <input type="text" id="text" placeholder="Enter message"><input class="button" type="submit" value="Send">
    </form>
  </div>
<script type="text/javascript">
  let node = new Node(generateId());
  $('#node-id').text(`Node Id: ${node.node.id}`);
  if(window.location.hash) {
    // find station id from url hash
    var stationId = window.location.hash.substring(1);
    $('#station-id').text(`Station Id: ${stationId}`);
    node.connect(stationId);
  } else {
    // no station id given
  }
  // Send a chat message to all active connections.
  $('#send').submit(function(e) {
    e.preventDefault();
    var msg = $('#text').val();
    node.connections.forEach((nodeId) => {
      node.transmitMsg(nodeId, msg);
    });
    displayMsg(node.node.id, msg);
    $('#text').val('');
    $('#text').focus();
  });
</script>
</body>
</html>